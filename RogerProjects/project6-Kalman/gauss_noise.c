/*****************************************************************************/
/*****                     Gaussian noise generator                      *****/
/*****************************************************************************/
#include <math.h>
#include <stdio.h>
#include <stdlib.h>

#ifndef MAX_RAND
#define MAX_RAND   2147483647.0
#endif

double xx[31] = {-3.0, -2.8, -2.6, -2.4, -2.2, -2.0, -1.8, -1.6, -1.4, -1.2,
		 -1.0, -0.8, -0.6, -0.4, -0.2,  0.0,  0.2,  0.4,  0.6,  0.8,
		 1.0,  1.2,  1.4,  1.6,  1.8,  2.0,  2.2,  2.4,  2.6,  2.8,
		 3.0};

double px[31] = {0.0013940399, 0.0026287699, 0.0047786120, 0.0083763619,
		 0.0141632743, 0.0231098302, 0.0364039426, 0.0553910419,
		 0.0814558719, 0.1158472240, 0.1594629019, 0.2126291295,
		 0.2749207450, 0.3450702193, 0.4210015026, 0.5000000000,
		 0.5789984974, 0.6549297807, 0.7250792550, 0.7873708705,
		 0.8405370981, 0.8841527760, 0.9185441281, 0.9446089581,
		 0.9635960574, 0.9768901698, 0.9858367257, 0.9916236381,
		 0.9952213880, 0.9973712301, 0.9986059601};

/*** Returns random variable with normal dist., mean = 0 and variance=sigma***/
double gauss_noise(sigma)
double sigma;
{
  double x,noise;
  int    i;

  x = ((double) random ())/MAX_RAND;
  for (i=0; i<31; i++) if (x < px[i]) break;
  if (i == 30) noise = 3.0*sigma;
  else if (i == 0) noise = -3.0*sigma;
  else noise = (xx[i-1]+(x-px[i-1])*(xx[i]-xx[i-1])/(px[i]-px[i-1]))*sigma;
  return(noise);
}
